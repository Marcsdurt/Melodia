<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0e0c09">
  <title>Melodia</title>
  <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/android-chrome-512x512.png">
  <link rel="manifest" href="icons/site.webmanifest">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400&family=Nunito+Sans:wght@300;400;600&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="base.css">
  <link rel="stylesheet" href="components.css">
  <link rel="stylesheet" href="settings.css">
</head>
<body>

<!-- ‚îÄ‚îÄ‚îÄ SIDEBAR OVERLAY (mobile) ‚îÄ‚îÄ‚îÄ -->
<div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>

<!-- ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ -->
<aside class="sidebar" id="sidebar">
  <div class="logo">
    <div class="logo-mark">Melodia<span>.</span></div>
    <div class="logo-sub">Di√°rio Musical</div>
  </div>
  <nav class="nav">
    <div class="nav-label">Principal</div>
    <div class="nav-item active" data-view="feed" onclick="navigate('feed');closeSidebar()">
      <span class="nav-icon">‚óà</span> Feed
    </div>
    <div class="nav-item" data-view="diary" onclick="navigate('diary');closeSidebar()">
      <span class="nav-icon">‚úé</span> Di√°rio
      <span class="nav-badge" id="badge-songs">0</span>
    </div>
    <div class="nav-label">Cole√ß√£o</div>
    <div class="nav-item" data-view="library" onclick="navigate('library');closeSidebar()">
      <span class="nav-icon">‚äû</span> Biblioteca
    </div>
    <div class="nav-item" data-view="search" onclick="navigate('search');closeSidebar()">
      <span class="nav-icon">‚åï</span> Buscar
    </div>
    <div class="nav-label">Voc√™</div>
    <div class="nav-item" data-view="profile" onclick="navigate('profile');closeSidebar()">
      <span class="nav-icon">‚ô™</span> Perfil
    </div>
    <div class="nav-item" data-view="settings" onclick="navigate('settings');closeSidebar()">
      <span class="nav-icon">‚öô</span> Configura√ß√µes
    </div>
  </nav>
  <div class="sidebar-user" onclick="navigate('profile');closeSidebar()">
    <div class="sidebar-avatar" id="sidebar-avatar">‚ô™</div>
    <div class="sidebar-user-info">
      <div class="sidebar-user-name" id="sidebar-user-name">Meu Perfil</div>
      <div class="sidebar-user-sub">Ver perfil completo</div>
    </div>
    <span style="color:var(--cream-faint);font-size:12px">‚Ä∫</span>
  </div>
</aside>

<!-- ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ -->
<main class="main">

  <!-- TOP BAR -->
  <header class="topbar">
    <button class="hamburger" onclick="openSidebar()" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
    <h1 class="topbar-title" id="topbar-title">In√≠cio</h1>
    <div class="search-wrap">
      <span class="search-icon">‚åï</span>
      <input type="text" id="search-input" placeholder="Buscar‚Ä¶" oninput="handleSearch()">
    </div>
  </header>

  <div class="content">

    <!-- FEED -->
    <div class="view active" id="view-feed">
      <div id="feed-container"></div>
    </div>

    <!-- DI√ÅRIO -->
    <div class="view" id="view-diary">
      <div class="diary-filters" id="diary-filters"></div>
      <div id="diary-container"></div>
    </div>

    <!-- BUSCAR -->
    <div class="view" id="view-search">
      <div id="search-container"></div>
    </div>

    <!-- BIBLIOTECA -->
    <div class="view" id="view-library">
      <div id="library-container"></div>
    </div>

    <!-- PERFIL -->
    <div class="view" id="view-profile">
      <div id="profile-container"></div>
    </div>

    <!-- DETALHE -->
    <div class="view" id="view-detail">
      <button class="back-btn" onclick="backFromDetail()">‚Üê Voltar</button>
      <div id="detail-content"></div>
    </div>

    <!-- CONFIGURA√á√ïES -->
    <div class="view" id="view-settings">
      <div id="settings-content"></div>
    </div>

  </div><!-- /content -->

  <!-- ‚îÄ‚îÄ‚îÄ BOTTOM NAV (mobile) ‚îÄ‚îÄ‚îÄ -->
  <nav class="bottom-nav">
    <div class="bottom-nav-item active" data-bnview="feed" onclick="navigate('feed')">
      <span class="bn-icon">‚óà</span>
      <span>Feed</span>
    </div>
    <div class="bottom-nav-item" data-bnview="diary" onclick="navigate('diary')">
      <span class="bn-icon">‚úé</span>
      <span>Di√°rio</span>
    </div>
    <div class="bottom-nav-fab-slot">
      <button class="fab-central" onclick="openAddModal()" aria-label="Registrar m√∫sica">
        <span class="fab-central-icon">+</span>
      </button>
    </div>
    <div class="bottom-nav-item" data-bnview="library" onclick="navigate('library')">
      <span class="bn-icon">‚äû</span>
      <span>Biblioteca</span>
    </div>
    <div class="bottom-nav-item" data-bnview="profile" onclick="navigate('profile')">
      <span class="bn-icon">‚ô™</span>
      <span>Perfil</span>
    </div>
  </nav>

</main>

<!-- ‚îÄ‚îÄ‚îÄ MODAL: ADICIONAR M√öSICA ‚îÄ‚îÄ‚îÄ -->
<div class="modal-backdrop" id="modal-add">
  <div class="modal" style="max-width:640px">
    <div class="modal-header">
      <div>
        <div class="modal-title" id="modal-add-title">Registrar M√∫sica</div>
        <div class="modal-title-sub">Busque na biblioteca ou preencha manualmente</div>
      </div>
      <button class="modal-close" onclick="closeModal('modal-add')">√ó</button>
    </div>

    <div class="modal-search-zone" id="modal-search-zone">
      <div class="search-api-wrap">
        <span class="search-icon">‚åï</span>
        <input type="text" id="api-search-input" class="search-api-input"
          placeholder="Buscar m√∫sicas, artistas ou √°lbuns na biblioteca‚Ä¶"
          oninput="debounceApiSearch()" autocomplete="off">
        <span class="search-api-spinner" id="api-spinner">‚Üª</span>
      </div>
      <div id="api-results" class="api-results"></div>
    </div>

    <div class="modal-divider" id="modal-divider">
      <span>ou preencha manualmente</span>
    </div>

    <div class="modal-body">
      <div class="form-row two">
        <div>
          <label class="form-label">T√≠tulo da M√∫sica *</label>
          <input class="form-input" id="f-title" placeholder="ex: Clair de Lune">
        </div>
        <div>
          <label class="form-label">Artista *</label>
          <input class="form-input" id="f-artist" placeholder="ex: Claude Debussy">
        </div>
      </div>
      <div class="form-row two">
        <div>
          <label class="form-label">√Ålbum</label>
          <input class="form-input" id="f-album" placeholder="ex: Suite bergamasque">
        </div>
        <div>
          <label class="form-label">Ano</label>
          <input class="form-input" id="f-year" type="number" placeholder="ex: 1890" min="1500" max="2030">
        </div>
      </div>
      <div class="form-row two">
        <div>
          <label class="form-label">G√™nero</label>
          <select class="form-input" id="f-genre">
            <option value="">‚Äî Selecionar ‚Äî</option>
            <optgroup label="Rock">
              <option>Rock</option>
              <option>Alternative Rock</option>
              <option>Indie Rock</option>
              <option>Hard Rock</option>
              <option>Punk Rock</option>
              <option>Progressive Rock</option>
              <option>Post-Rock</option>
              <option>Grunge</option>
              <option>Shoegaze</option>
              <option>Emo</option>
              <option>Garage Rock</option>
              <option>Punk</option>
              <option>Blues Rock</option>
            </optgroup>
            <optgroup label="Pop">
              <option>Pop</option>
              <option>Indie Pop</option>
              <option>Synthpop</option>
              <option>Electropop</option>
              <option>Dream Pop</option>
              <option>Dance Pop</option>
              <option>Teen Pop</option>
              <option>Art Pop</option>
              <option>K-Pop</option>
            </optgroup>
            <optgroup label="Hip Hop &amp; Rap">
              <option>Hip Hop</option>
              <option>Rap</option>
              <option>Trap</option>
              <option>Boom Bap</option>
              <option>Drill</option>
              <option>Conscious Rap</option>
              <option>Cloud Rap</option>
              <option>Lo-fi Hip Hop</option>
              <option>Gangsta Rap</option>
              <option>Alternative Hip Hop</option>
            </optgroup>
            <optgroup label="R&amp;B &amp; Soul">
              <option>R&amp;B</option>
              <option>Contemporary R&amp;B</option>
              <option>Soul</option>
              <option>Neo Soul</option>
              <option>Quiet Storm</option>
              <option>Funk</option>
              <option>Disco</option>
            </optgroup>
            <optgroup label="Electronic">
              <option>Electronic</option>
              <option>House</option>
              <option>Deep House</option>
              <option>Tech House</option>
              <option>Techno</option>
              <option>Minimal Techno</option>
              <option>Trance</option>
              <option>Drum and Bass</option>
              <option>Dubstep</option>
              <option>Ambient</option>
              <option>Synthwave</option>
              <option>Hyperpop</option>
              <option>Future Bass</option>
            </optgroup>
            <optgroup label="Metal">
              <option>Metal</option>
              <option>Heavy Metal</option>
              <option>Thrash Metal</option>
              <option>Death Metal</option>
              <option>Black Metal</option>
              <option>Metalcore</option>
              <option>Doom Metal</option>
              <option>Progressive Metal</option>
              <option>Nu Metal</option>
            </optgroup>
            <optgroup label="Jazz">
              <option>Jazz</option>
              <option>Bebop</option>
              <option>Swing</option>
              <option>Smooth Jazz</option>
              <option>Jazz Fusion</option>
              <option>Modal Jazz</option>
              <option>Free Jazz</option>
            </optgroup>
            <optgroup label="Blues">
              <option>Blues</option>
              <option>Delta Blues</option>
              <option>Chicago Blues</option>
              <option>Electric Blues</option>
            </optgroup>
            <optgroup label="Classical">
              <option>Classical</option>
              <option>Baroque</option>
              <option>Romantic</option>
              <option>Contemporary Classical</option>
              <option>Minimalism</option>
              <option>Orchestral</option>
            </optgroup>
            <optgroup label="Latin">
              <option>Latin</option>
              <option>Reggaeton</option>
              <option>Salsa</option>
              <option>Bachata</option>
              <option>Merengue</option>
              <option>Cumbia</option>
              <option>Latin Pop</option>
              <option>Samba</option>
              <option>Bossa Nova</option>
            </optgroup>
            <optgroup label="Folk &amp; Country">
              <option>Folk</option>
              <option>Indie Folk</option>
              <option>Folk Rock</option>
              <option>Americana</option>
              <option>Contemporary Folk</option>
              <option>Country</option>
              <option>Country Pop</option>
              <option>Country Rock</option>
              <option>Bluegrass</option>
              <option>Outlaw Country</option>
            </optgroup>
            <optgroup label="Outros">
              <option>Reggae</option>
              <option>Gospel</option>
              <option>World Music</option>
              <option>Experimental</option>
            </optgroup>
          </select>
        </div>
        <div>
          <label class="form-label">Playlist</label>
          <select class="form-input" id="f-playlist">
            <option value="">‚Äî Nenhuma ‚Äî</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <label class="form-label">Capa da M√∫sica</label>
        <div class="cover-upload-zone" id="cover-upload-zone">
          <input type="file" accept="image/*" onchange="handleCoverUpload(event)">
          <img id="cover-preview" class="cover-upload-preview" style="display:none" src="" alt="">
          <div class="cover-upload-label">Clique ou arraste uma foto da capa</div>
          <div class="cover-upload-hint">JPG, PNG, WEBP ‚Ä¢ ou use a arte obtida pela busca</div>
        </div>
        <input type="hidden" id="f-itunes-art">
        <input type="hidden" id="f-cover-url">
      </div>
      <div class="form-row">
        <label class="form-label">Sua Nota</label>
        <div class="star-picker" id="star-picker">
          <span class="star-pick" data-v="1" onclick="setRating(1)">‚òÖ</span>
          <span class="star-pick" data-v="2" onclick="setRating(2)">‚òÖ</span>
          <span class="star-pick" data-v="3" onclick="setRating(3)">‚òÖ</span>
          <span class="star-pick" data-v="4" onclick="setRating(4)">‚òÖ</span>
          <span class="star-pick" data-v="5" onclick="setRating(5)">‚òÖ</span>
        </div>
      </div>
      <div class="form-row">
        <label class="form-label">Letra da M√∫sica</label>
        <textarea class="form-input" id="f-lyrics"
          placeholder="Cole aqui a letra da m√∫sica para poder marcar seus trechos favoritos‚Ä¶"
          style="min-height:140px;font-style:italic;line-height:1.8"></textarea>
      </div>
      <div class="form-row">
        <label class="form-label">Anota√ß√µes &amp; Sentimentos</label>
        <textarea class="form-input" id="f-notes"
          placeholder="O que essa m√∫sica faz voc√™ sentir? Onde voc√™ a ouviu? Que mem√≥ria ela traz?"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-add')">Cancelar</button>
      <button class="btn btn-primary" onclick="saveSong()">Salvar M√∫sica</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ MODAL: NOVA PLAYLIST ‚îÄ‚îÄ‚îÄ -->
<div class="modal-backdrop" id="modal-playlist">
  <div class="modal">
    <div class="modal-header">
      <div>
        <div class="modal-title">Nova Playlist</div>
        <div class="modal-title-sub">Crie uma cole√ß√£o tem√°tica</div>
      </div>
      <button class="modal-close" onclick="closeModal('modal-playlist')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-row two">
        <div>
          <label class="form-label">Emoji</label>
          <input class="form-input" id="p-emoji" placeholder="üé∏" maxlength="4">
        </div>
        <div>
          <label class="form-label">Nome *</label>
          <input class="form-input" id="p-name" placeholder="ex: Para os dias de chuva">
        </div>
      </div>
      <div class="form-row">
        <label class="form-label">Descri√ß√£o</label>
        <textarea class="form-input" id="p-desc"
          placeholder="Descreva o clima ou tema desta playlist‚Ä¶" style="min-height:70px"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-playlist')">Cancelar</button>
      <button class="btn btn-primary" onclick="savePlaylist()">Criar Playlist</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ MODAL: COMPARTILHAR ‚îÄ‚îÄ‚îÄ -->
<div class="modal-backdrop" id="modal-share">
  <div class="modal" style="max-width:680px">
    <div class="modal-header">
      <div>
        <div class="modal-title">Compartilhar M√∫sica</div>
        <div class="modal-title-sub">Gere uma imagem para o seu Stories</div>
      </div>
      <button class="modal-close" onclick="closeModal('modal-share')">√ó</button>
    </div>
    <div class="modal-body" style="padding-bottom:0">
      <div class="share-preview-wrap">
        <canvas id="share-canvas" width="1080" height="1920"></canvas>
      </div>
      <div class="share-controls">
        <div id="share-verses-section" style="display:none">
          <div class="share-control-label">‚ú¶ Escolha at√© 3 versos para aparecer na imagem (m√°x. 78 caracteres no total)</div>
          <div class="share-verses-list" id="share-verses-list"></div>
        </div>
        <div class="share-control-label" style="margin-top:18px">Tema</div>
        <div class="share-themes">
          <button class="share-theme-btn active" data-theme="dark" onclick="setShareTheme('dark')">
            <span class="theme-dot" style="background:#0e0c09;border:1px solid #c9a84c"></span> Escuro
          </button>
          <button class="share-theme-btn" data-theme="gold" onclick="setShareTheme('gold')">
            <span class="theme-dot" style="background:#c9a84c"></span> Dourado
          </button>
          <button class="share-theme-btn" data-theme="light" onclick="setShareTheme('light')">
            <span class="theme-dot" style="background:#f5f0e8;border:1px solid #ccc"></span> Claro
          </button>
          <button class="share-theme-btn" data-theme="night" onclick="setShareTheme('night')">
            <span class="theme-dot" style="background:#0a0a1a;border:1px solid #6060ff"></span> Noite
          </button>
        </div>
        <div id="share-user-section" style="display:none;margin-top:18px">
          <div class="share-control-label">Exibir no Stories</div>
          <label class="settings-toggle-row" style="cursor:pointer" onclick="toggleShareUser()">
            <div>
              <div style="font-size:13px;color:var(--cream)">Mostrar meu perfil</div>
              <div style="font-size:11px;color:var(--cream-dim)">Foto e nome aparecem na imagem</div>
            </div>
            <div class="settings-toggle" id="share-user-toggle"></div>
          </label>
        </div>
      </div>
    </div>
    <div class="modal-footer" style="padding-top:20px">
      <button class="btn btn-ghost" onclick="closeModal('modal-share')">Fechar</button>
      <button class="btn btn-primary" onclick="downloadStorie()">‚Üì Baixar Imagem</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ -->
<div class="toast" id="toast">
  <div class="toast-title" id="toast-title"></div>
  <div id="toast-msg"></div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ SCRIPTS (ordem importa: state ‚Üí render ‚Üí songs ‚Üí share ‚Üí app) ‚îÄ‚îÄ‚îÄ -->
<script src="state.js"></script>
<script src="render.js"></script>
<script src="songs.js"></script>
<script src="share.js"></script>
<script src="app.js"></script>

</body>
</html>